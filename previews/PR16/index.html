<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Armon.jl</title><meta name="title" content="Home · Armon.jl"/><meta property="og:title" content="Home · Armon.jl"/><meta property="twitter:title" content="Home · Armon.jl"/><meta name="description" content="Documentation for Armon.jl."/><meta property="og:description" content="Documentation for Armon.jl."/><meta property="twitter:description" content="Documentation for Armon.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Armon.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Parameters-and-entry-point"><span>Parameters and entry point</span></a></li><li><a class="tocitem" href="#Grid-and-blocks"><span>Grid and blocks</span></a></li><li><a class="tocitem" href="#Block-states"><span>Block states</span></a></li><li><a class="tocitem" href="#Device-and-backends"><span>Device and backends</span></a></li><li><a class="tocitem" href="#Kernels"><span>Kernels</span></a></li><li><a class="tocitem" href="#Logging"><span>Logging</span></a></li><li><a class="tocitem" href="#Utility"><span>Utility</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Keluaa/Armon.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Keluaa/Armon.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Armon"><a class="docs-heading-anchor" href="#Armon">Armon</a><a id="Armon-1"></a><a class="docs-heading-anchor-permalink" href="#Armon" title="Permalink"></a></h1><p>Documentation for <a href="https://github.com/Keluaa/Armon.jl">Armon</a>.</p><p>Armon is a 2D CFD solver for compressible non-viscous fluids, using the finite volume method.</p><p>It was made to explore Julia&#39;s capabilities in HPC and for performance portability: it should perform very well on any CPU and GPU. Domain decomposition using MPI is supported.</p><p>The twin project <a href="https://github.com/Keluaa/Armon-Kokkos">Armon-Kokkos</a> is a mirror of the core of this solver (with much less options) written in C++ using the Kokkos library. It is possible to reuse kernels from that solver in this one, using the <a href="https://github.com/Keluaa/Kokkos.jl">Kokkos.jl</a> package.</p><h2 id="Parameters-and-entry-point"><a class="docs-heading-anchor" href="#Parameters-and-entry-point">Parameters and entry point</a><a id="Parameters-and-entry-point-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters-and-entry-point" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.ArmonParameters" href="#Armon.ArmonParameters"><code>Armon.ArmonParameters</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ArmonParameters(; options...)</code></pre><p>The parameters and current state of the solver.</p><p>The state is reset at each call to <a href="#Armon.armon"><code>armon</code></a>.</p><p>There are many options. Each backend can add their own.</p><p><strong>Options</strong></p><p><strong>Backend and MPI</strong></p><pre><code class="nohighlight hljs">device = :CUDA</code></pre><p>Device to use. Supported values:</p><ul><li><code>:CPU_HP</code>: <code>Polyester.jl</code> CPU multithreading  (default if <code>use_gpu=false</code>)</li><li><code>:CUDA</code>: <code>CUDA.jl</code> GPU (default if <code>use_gpu=true</code>)</li><li><code>:ROCM</code>: <code>AMDGPU.jl</code> GPU</li><li><code>:CPU</code>: <code>KernelAbstractions.jl</code> CPU multithreading (using the standard <code>Threads.jl</code>)</li></ul><pre><code class="nohighlight hljs">use_MPI = true, P = (1, 1), reorder_grid = true, global_comm = nothing</code></pre><p>MPI config. The MPI domain will be a process grid of size <code>P</code>. <code>global_comm</code> is the global communicator to use, defaults to <code>MPI.COMM_WORLD</code>. <code>reorder_grid</code> is passed to <code>MPI.Cart_create</code>.</p><pre><code class="nohighlight hljs">gpu_aware = true</code></pre><p>Store MPI buffers on the device. This requires to use a GPU-aware MPI implementation. Does nothing when using the CPU only.</p><pre><code class="nohighlight hljs">numa_aware = true</code></pre><p>Allocate memory according to which NUMA node is associated with the thread supposed to work on a chunk of memory. This effectively enforces the <em>first-touch</em> policy, instead of blindly relying on it.</p><pre><code class="nohighlight hljs">lock_memory = false</code></pre><p>Lock all memory pages using <code>mlock</code> to RAM.</p><p><strong>Kernels</strong></p><pre><code class="nohighlight hljs">use_threading = true, use_simd = true</code></pre><p>Switches for <a href="#Armon.CPU_HP"><code>CPU_HP</code></a> kernels. <code>use_threading</code> enables <a href="#Armon.@threaded"><code>@threaded</code></a> for outer loops. <code>use_simd</code> enables <a href="#Armon.@simd_loop"><code>@simd_loop</code></a> for inner loops.</p><pre><code class="nohighlight hljs">use_gpu = false</code></pre><p>Enables the use of <code>KernelAbstractions.jl</code> kernels.</p><pre><code class="nohighlight hljs">use_kokkos = false</code></pre><p>Use kernels for <code>Kokkos.jl</code>.</p><pre><code class="nohighlight hljs">use_cache_blocking = true</code></pre><p>Separate the domain into semi-independant blocks, improving the cache-locality of memory accesses and therefore memory throughput.</p><pre><code class="nohighlight hljs">async_cycle = false</code></pre><p>Apply all steps of the solver to all blocks asynchronously, fully taking advantage of cache blocking.</p><pre><code class="nohighlight hljs">block_size = 1024</code></pre><p>Size of blocks for cache blocking. Can be a tuple. If <code>use_cache_blocking == false</code>, this option only controls the size of GPU blocks.</p><pre><code class="nohighlight hljs">use_two_step_reduction = false</code></pre><p>Reduction kernels (<code>dtCFL_kernel</code> and <code>conservation_vars</code>) use some optimizations to perform the reduction in a single step. It might cause issues on some GPU backends: a more &quot;gentle&quot; approach could avoid those by doing it in two steps.</p><pre><code class="nohighlight hljs">workload_distribution = :simple</code></pre><p>Dictates how blocks are distributed among threads when <code>async_cycle == true</code>:</p><ul><li><code>:simple</code> trivially spreads all blocks to all threads evenly</li><li><code>:square</code> divides the block grid into rectangles (closely shaped as squares) for each thread, with the goal of minimizing the perimeter of rectangles to reduce the interaction with other threads as much as possible</li><li><code>:sorted_square</code> is the same as <code>:square</code>, but additionally sorts the blocks to work on those at the perimeter of the square first, reducing the likelyness of waiting for neighbouring threads</li><li><code>:scotch</code> uses the <a href="https://gitlab.inria.fr/scotch/scotch"><code>Scotch</code></a> solver to partition the block grid</li><li><code>:sorted_scotch</code> is the same as <code>:scotch</code>, but with the same additional sorting strategy of <code>:sorted_square</code></li><li><code>:weighted_sorted_scotch</code> takes into account the number of cells in each block instead of assuming an even workload for all blocks</li></ul><pre><code class="nohighlight hljs">busy_wait_limit = 100</code></pre><p>Number of calls in a cycle to <a href="#Armon.block_state_machine"><code>block_state_machine</code></a> which did not advance any of a thread&#39;s blocks until a call to <code>MPI_Wait</code> or a system sleep is done. This is only relevant when <code>async_cycle == true</code>.</p><p><strong>Profiling</strong></p><pre><code class="nohighlight hljs">profiling = Symbol[]</code></pre><p>List of profiling callbacks to use:</p><ul><li><code>:TimerOutputs</code>: <code>TimerOutputs.jl</code> sections (added if <code>measure_time=true</code>)</li><li><code>:NVTX_sections</code>: <code>NVTX.jl</code> sections</li><li><code>:NVTX_kernels</code>: <code>NVTX.jl</code> sections for kernels</li><li><code>:CUDA_kernels</code>: equivalent to <code>CUDA.@profile</code> in front of all kernels</li></ul><pre><code class="nohighlight hljs">measure_time = true</code></pre><p><code>measure_time=false</code> can remove any overhead caused by profiling.</p><pre><code class="nohighlight hljs">time_async = true</code></pre><p><code>time_async=false</code> will add a barrier at the end of every section. Useful for GPU kernels.</p><p><strong>Scheme and CFD solver</strong></p><pre><code class="nohighlight hljs">scheme = :GAD, riemann_limiter = :minmod</code></pre><p><code>scheme</code> is the Riemann solver scheme to use:</p><ul><li><code>:Godunov</code> (1st order)</li><li><code>:GAD</code> (2nd order, with limiter).</li></ul><p><code>riemann_limiter</code> is the limiter to use for the Riemann solver: <code>:no_limiter</code>, <code>:minmod</code> or <code>:superbee</code>.</p><pre><code class="nohighlight hljs">projection = :euler_2nd</code></pre><p>Scheme for the Eulerian remap step:</p><ul><li><code>:euler</code> (1st order)</li><li><code>:euler_2nd</code> (2nd order, +minmod limiter)</li></ul><pre><code class="nohighlight hljs">axis_splitting = :Sequential</code></pre><p>Axis splitting to use:</p><ul><li><code>:Sequential</code>: X then Y</li><li><code>:SequentialSym</code> (or <code>:Godunov</code>): X and Y then Y and X, alternating</li><li><code>:Strang</code>: ½X, Y, ½X then ½Y, X, ½Y, alternating (½ is for halved time step)</li><li><code>:X_only</code></li><li><code>:Y_only</code></li></ul><pre><code class="nohighlight hljs">N = (10, 10)</code></pre><p>Number of cells of the global domain in each axes.</p><pre><code class="nohighlight hljs">nghost = 4</code></pre><p>Number of ghost cells. Must be greater or equal to the minimum number of ghost cells (min 1, <code>scheme=:GAD</code> adds one, <code>projection=:euler_2nd</code> adds one, <code>scheme=:GAD</code> + <code>projection=:euler_2nd</code> adds another one)</p><pre><code class="nohighlight hljs">Dt = 0., cst_dt = false, dt_on_even_cycles = false</code></pre><p><code>Dt</code> is the initial time step, it is computed after initialization by default. If <code>cst_dt=true</code> then the time step is always <code>Dt</code> and no reduction over the entire domain occurs.  If <code>dt_on_even_cycles=true</code> then then time step is only updated at even cycles (the first cycle is even).</p><pre><code class="nohighlight hljs">data_type = Float64</code></pre><p>Data type for all variables. Should be an <code>AbstractFloat</code>.</p><p><strong>Test case and domain</strong></p><pre><code class="nohighlight hljs">test = :Sod, domain_size = nothing, origin = nothing</code></pre><p><code>test</code> is the test case name to use:</p><ul><li><code>:Sod</code>: Sod shock tube test</li><li><code>:Sod_y</code>: Sod shock tube test along the Y axis</li><li><code>:Sod_circ</code>: Circular Sod shock tube test (centered in the domain)</li><li><code>:Bizarrium</code>: Bizarrium test, similar to the Sod shock tube but with a special equation of state</li><li><code>:Sedov</code>: Sedov blast-wave test (centered in the domain, reaches the border at <code>t=1</code> by default)</li><li><code>:DebugIndexes</code>: Set all variables to their index in the global domain. Debug only.</li></ul><pre><code class="nohighlight hljs">cfl = 0., maxtime = 0., maxcycle = 500_000</code></pre><p><code>cfl</code> defaults to the test&#39;s default value, same for <code>maxtime</code>. The solver stops when <code>t</code> reaches <code>maxtime</code> or <code>maxcycle</code> iterations were done (<code>maxcycle=0</code> stops after initialization).</p><p><strong>Output</strong></p><pre><code class="nohighlight hljs">silent = 0</code></pre><p><code>silent=0</code> for maximum verbosity. <code>silent=3</code> doesn&#39;t print info at each cycle. <code>silent=5</code> doesn&#39;t print anything.</p><pre><code class="nohighlight hljs">output_dir = &quot;.&quot;, output_file = &quot;output&quot;</code></pre><p><code>joinpath(output_dir, output_file)</code> will be path to the output file.</p><pre><code class="nohighlight hljs">write_output = false, write_ghosts = false</code></pre><p><code>write_output=true</code> will write all <code>saved_vars()</code> to the output file. If <code>write_ghosts=true</code>, ghost cells will also be included.</p><pre><code class="nohighlight hljs">write_slices = false</code></pre><p>Will write all <code>saved_vars()</code> to 3 output files, one for the middle X row, another for the middle Y column, and another for the diagonal. If <code>write_ghosts=true</code>, ghost cells will also be included.</p><pre><code class="nohighlight hljs">output_precision = nothing</code></pre><p>Numbers are saved with <code>output_precision</code> digits of precision. Defaults to enough numbers for an exact decimal representation.</p><pre><code class="nohighlight hljs">animation_step = 0</code></pre><p>If <code>animation_step ≥ 1</code>, then every <code>animation_step</code> cycles, variables will be saved as with <code>write_output=true</code>.</p><pre><code class="nohighlight hljs">compare = false, is_ref = false, comparison_tolerance = 1e-10</code></pre><p>If <code>compare=true</code>, then at every sub step of each iteration of the solver all variables will:</p><ul><li>(<code>is_ref=false</code>) be compared with a reference file found in <code>output_dir</code></li><li>(<code>is_ref=true</code>) be saved to a reference file in <code>output_dir</code></li></ul><p>When comparing, a relative <code>comparison_tolerance</code> (the <code>rtol</code> kwarg of <code>isapprox</code>) is accepted between values.</p><pre><code class="nohighlight hljs">check_result = false</code></pre><p>Check if conservation of mass and energy is verified between initialization and the last iteration. An error is thrown otherwise. Accepts a relative <code>comparison_tolerance</code>.</p><pre><code class="nohighlight hljs">return_data = false</code></pre><p>If <code>return_data=true</code>, then in the <a href="#Armon.SolverStats"><code>SolverStats</code></a> returned by <a href="#Armon.armon"><code>armon</code></a>, the <code>data</code> field will contain the <a href="#Armon.BlockGrid"><code>BlockGrid</code></a> used by the solver.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/parameters.jl#L6-L270">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.armon" href="#Armon.armon"><code>Armon.armon</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">armon(::ArmonParameters)</code></pre><p>Main entry point of the solver. Returns a <a href="#Armon.SolverStats"><code>SolverStats</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver.jl#L406-L410">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.SolverStats" href="#Armon.SolverStats"><code>Armon.SolverStats</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SolverStats</code></pre><p>Solver output.</p><p><code>data</code> is <code>nothing</code> if <code>parameters.return_data</code> is <code>false</code>.</p><p><code>timer</code> is <code>nothing</code> if <code>parameters.measure_time</code> is <code>false</code>.</p><p><code>grid_log</code> is <code>nothing</code> if <code>parameters.log_blocks</code> is <code>false</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver.jl#L2-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.StepsRanges" href="#Armon.StepsRanges"><code>Armon.StepsRanges</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">StepsRanges</code></pre><p>Holds indexing information for all steps of the solver.</p><p>Domains are stored as block corner offsets: blocks can have different sizes, but always the same amount of ghost cells, therefore the iteration domain is determined from the dimensions of the block. The first field is the offset to the first cell, the second is the offset to the last cell.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/domain_ranges.jl#L87-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.data_type" href="#Armon.data_type"><code>Armon.data_type</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">data_type(::ArmonParameters{T})</code></pre><p>Get <code>T</code>, the type used for numbers by the solver</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/parameters.jl#L933-L937">source</a></section></article><h2 id="Grid-and-blocks"><a class="docs-heading-anchor" href="#Grid-and-blocks">Grid and blocks</a><a id="Grid-and-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#Grid-and-blocks" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockGrid" href="#Armon.BlockGrid"><code>Armon.BlockGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BlockGrid{T, DeviceA, HostA, BufferA, Ghost, BlockSize, Device, SolverState}</code></pre><p>Stores <a href="#Armon.TaskBlock"><code>TaskBlock</code></a>s on the <code>Device</code> and host memory, in a grid.</p><p><a href="#Armon.LocalTaskBlock"><code>LocalTaskBlock</code></a> are stored separately depending on if they have a <a href="#Armon.StaticBSize"><code>StaticBSize</code></a> of <code>BlockSize</code> (in <code>blocks</code>) or if they have a <a href="#Armon.DynamicBSize"><code>DynamicBSize</code></a> (in <code>edge_blocks</code>).</p><p>Blocks have <code>Ghost</code> cells padding their real cells. This is included in their <a href="#Armon.block_size"><code>block_size</code></a>. A block cannot have a number of real cells along an axis smaller than the number of ghost cells, unless there is only a single block in the grid along that axis.</p><p>&quot;Edge blocks&quot; are blocks located on the right and/or top edge of the grid. They exist in order to handle domains with dimensions which are not multiples of the block size.</p><p><code>DeviceA</code> and <code>HostA</code> are <code>AbstractArray</code> types for the device and host respectively.</p><p><code>BufferA</code> is the type of storage used for MPI buffers. MPI buffers are homogenous: they are either all on the host or all on the device.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L2-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.grid_dimensions" href="#Armon.grid_dimensions"><code>Armon.grid_dimensions</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">grid_dimensions(params::ArmonParameters)
grid_dimensions(block_size::NTuple{D, Int}, domain_size::NTuple{D, Int}, ghost::Int) where {D}</code></pre><p>Returns the dimensions of the grid in the form <code>(grid_size, static_sized_grid, remainder_block_size)</code> from the <code>block_size</code> (the size of blocks in the <code>static_sized_grid</code>), the <code>domain_size</code> (number of real cells) and the number of <code>ghost</code> cells, common to all blocks.</p><p><code>grid_size</code> is the <code>static_sized_grid</code> including the edge blocks. Edge blocks along the axis <code>d</code> have a size of <code>remainder_block_size[d]</code> along <code>d</code> only if they are at the edge of the grid along <code>d</code>, or <code>block_size</code> otherwise.</p><p><code>block_size</code> includes the <code>ghost</code> cells in its dimensions, which must all be greater than <code>2*ghost</code>.</p><p>If <code>prod(block_size) == 0</code>, then <code>block_size</code> is ignored and the grid is made of only a single block of size <code>domain_size</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Blocks must not be smaller than <code>ghost</code>, therefore edge blocks might be made bigger than <code>block_size</code>.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In case <code>domain_size</code> is smaller than <code>block_size .- 2*ghost</code> along any axis, the grid will contain only edge blocks.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L322-L348">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.TaskBlock" href="#Armon.TaskBlock"><code>Armon.TaskBlock</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">TaskBlock{V}</code></pre><p>Abstract block used for cache blocking.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocks.jl#L2-L6">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.LocalTaskBlock" href="#Armon.LocalTaskBlock"><code>Armon.LocalTaskBlock</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">LocalTaskBlock{D, H, Size, SolverState} &lt;: TaskBlock{V}</code></pre><p>Container of <code>Size</code> and variables of type <code>D</code> on the device and <code>H</code> on the host. Part of a <a href="#Armon.BlockGrid"><code>BlockGrid</code></a>.</p><p>The block stores its own solver state, allowing it to run all solver steps independantly of all other blocks, apart from steps requiring synchronization.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocks.jl#L59-L67">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockData" href="#Armon.BlockData"><code>Armon.BlockData</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BlockData{V}</code></pre><p>Holds the variables of all cells of a <a href="#Armon.LocalTaskBlock"><code>LocalTaskBlock</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocks.jl#L13-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.RemoteTaskBlock" href="#Armon.RemoteTaskBlock"><code>Armon.RemoteTaskBlock</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">RemoteTaskBlock{B} &lt;: TaskBlock{B}</code></pre><p>Block located at the border of a <a href="#Armon.BlockGrid"><code>BlockGrid</code></a>, containing MPI buffer of type <code>B</code> for communication with other <a href="#Armon.BlockGrid"><code>BlockGrid</code></a>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocks.jl#L168-L173">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.device_to_host!" href="#Armon.device_to_host!"><code>Armon.device_to_host!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">device_to_host!(blk::LocalTaskBlock)</code></pre><p>Copies the device data of <code>blk</code> to the host data. A no-op if the device is the host.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocks.jl#L116-L120">source</a></section><section><div><pre><code class="language-julia hljs">device_to_host!(grid::BlockGrid)</code></pre><p>Copies device data of all blocks to the host data. A no-op if the device is the host.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L712-L716">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.host_to_device!" href="#Armon.host_to_device!"><code>Armon.host_to_device!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">device_to_host!(blk::LocalTaskBlock)</code></pre><p>Copies the host data of <code>blk</code> to its device data. A no-op if the device is the host.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocks.jl#L132-L136">source</a></section><section><div><pre><code class="language-julia hljs">device_to_host!(grid::BlockGrid)</code></pre><p>Copies host data of all blocks to the device data. A no-op if the device is the host.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L726-L730">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.buffers_on_device" href="#Armon.buffers_on_device"><code>Armon.buffers_on_device</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">buffers_on_device(::BlockGrid)
buffers_on_device(::Type{&lt;:BlockGrid})</code></pre><p><code>true</code> if the communication buffers are stored on the device, allowing direct transfers without passing through the host (GPU-aware communication).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L545-L551">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.device_is_host" href="#Armon.device_is_host"><code>Armon.device_is_host</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">device_is_host(::BlockGrid{T, D, H})
device_is_host(::Type{&lt;:BlockGrid{T, D, H}})</code></pre><p><code>true</code> if the device is the host, i.e. device blocks and host blocks are the same (and <code>D == H</code>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L536-L541">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.all_blocks" href="#Armon.all_blocks"><code>Armon.all_blocks</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">all_blocks(grid::BlockGrid)</code></pre><p>Simple iterator over all blocks of the grid, excluding <a href="#Armon.RemoteTaskBlock"><code>RemoteTaskBlock</code></a>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L528-L532">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_idx" href="#Armon.block_idx"><code>Armon.block_idx</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_idx(grid::BlockGrid, idx::CartesianIndex)</code></pre><p>Linear index in <code>grid.blocks</code> of the block at <code>idx</code> in the statically-sized grid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L430-L434">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.edge_block_idx" href="#Armon.edge_block_idx"><code>Armon.edge_block_idx</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">edge_block_idx(grid::BlockGrid, idx::CartesianIndex)</code></pre><p>Linear index in <code>grid.edge_blocks</code> of the block at <code>idx</code>, along the (dynamically-sized) edges of the <code>grid</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L439-L444">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.remote_block_idx" href="#Armon.remote_block_idx"><code>Armon.remote_block_idx</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">remote_block_idx(grid::BlockGrid, idx::CartesianIndex)</code></pre><p>Linear index in <code>grid.remote_blocks</code> of the remote block at <code>idx</code> in the <code>grid</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L458-L462">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.EdgeBlockRegions" href="#Armon.EdgeBlockRegions"><code>Armon.EdgeBlockRegions</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">EdgeBlockRegions(grid::BlockGrid; real_sizes=false)
EdgeBlockRegions(
    grid_size::NTuple{D, Int}, static_sized_grid::NTuple{D, Int},
    block_size::NTuple{D, Int}, remainder_block_size::NTuple{D, Int}; ghosts=0
)</code></pre><p>Iterator over edge blocks, their positions and their size in each edge region of the <code>grid</code>.</p><p><code>ghosts</code> only affects the size of edge blocks: <code>B .- 2*ghosts</code>. If <code>real_sizes == true</code>, then <code>ghosts</code> is <code>ghosts(grid)</code>, therefore the real block size of edge blocks is returned.</p><p>There is a maximum of <code>2^D-1</code> edge regions in a grid (<a href="https://en.wikipedia.org/wiki/Binomial_theorem#Geometric_explanation">see this explanation</a>). When <code>grid_size[i] != static_sized_grid[i]</code>, there cannot be an edge region, hence there are exactly <code>2^sum(grid_size .!= static_sized_grid)-1</code> regions.</p><pre><code class="language-julia-repl hljs">julia&gt; collect(Armon.EdgeBlockRegions((5, 5), (4, 4), (32, 32), (16, 16)))
3-element Vector{Tuple{Int64, CartesianIndices{2, Tuple{UnitRange{Int64}, UnitRange{Int64}}}, Tuple{Int64, Int64}}}:
 (4, CartesianIndices((5:5, 1:4)), (16, 32))
 (4, CartesianIndices((1:4, 5:5)), (32, 16))
 (1, CartesianIndices((5:5, 5:5)), (16, 16))

julia&gt; collect(Armon.EdgeBlockRegions((5, 5, 5), (4, 5, 4), (32, 32, 32), (16, 16, 16)))
3-element Vector{Tuple{Int64, CartesianIndices{3, Tuple{UnitRange{Int64}, UnitRange{Int64}, UnitRange{Int64}}}, Tuple{Int64, Int64, Int64}}}:
 (20, CartesianIndices((5:5, 1:5, 1:4)), (16, 32, 32))
 (20, CartesianIndices((1:4, 1:5, 5:5)), (32, 32, 16))
 (5, CartesianIndices((5:5, 1:5, 5:5)), (16, 32, 16))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L186-L216">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.RemoteBlockRegions" href="#Armon.RemoteBlockRegions"><code>Armon.RemoteBlockRegions</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">RemoteBlockRegions(grid::BlockGrid)
RemoteBlockRegions(grid_size::NTuple{D, Int})</code></pre><p>Iterator of all remote block positions in each region (the faces of the <code>grid</code>). There is always <code>2*D</code> regions.</p><pre><code class="language-julia-repl hljs">julia&gt; collect(Armon.RemoteBlockRegions((5, 3)))
4-element Vector{Tuple{Armon.Side.T, CartesianIndices{2, Tuple{UnitRange{Int64}, UnitRange{Int64}}}}}:
 (Armon.Side.Left, CartesianIndices((0:0, 1:3)))
 (Armon.Side.Right, CartesianIndices((6:6, 1:3)))
 (Armon.Side.Bottom, CartesianIndices((1:5, 0:0)))
 (Armon.Side.Top, CartesianIndices((1:5, 4:4)))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L275-L290">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@iter_blocks" href="#Armon.@iter_blocks"><code>Armon.@iter_blocks</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@iter_blocks for blk in grid
    # body...
end</code></pre><p>Applies the body of the for-loop in to all blocks of the <code>grid</code>. Threads iterate over the blocks they are assigned to via <code>grid.threads_workload</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L293-L300">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_pos_containing_cell" href="#Armon.block_pos_containing_cell"><code>Armon.block_pos_containing_cell</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_pos_containing_cell(grid::BlockGrid, pos::Union{CartesianIndex, NTuple})</code></pre><p>Returns two <code>CartesianIndex</code>es: the first is the position of the block containing the cell at <code>pos</code>, the second is the position of the cell in that block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L774-L779">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_origin" href="#Armon.block_origin"><code>Armon.block_origin</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_origin(grid::BlockGrid, pos, include_ghosts=false)</code></pre><p>A <code>Tuple</code> of the position of the cell at the bottom left corner of the <a href="#Armon.LocalTaskBlock"><code>LocalTaskBlock</code></a> at <code>pos</code> in the <code>grid</code>.</p><p>If <code>include_ghosts == true</code>, then the cell position includes all ghost cells of the <code>grid</code>.</p><p><code>pos</code> can be any of <code>Integer</code>, <code>NTuple{N, Integer}</code> or <code>CartesianIndex</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L799-L808">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_at" href="#Armon.block_at"><code>Armon.block_at</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_at(grid::BlockGrid, idx::CartesianIndex)</code></pre><p>The <a href="#Armon.TaskBlock"><code>TaskBlock</code></a> at position <code>idx</code> in the <code>grid</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L476-L480">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_size_at" href="#Armon.block_size_at"><code>Armon.block_size_at</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_size_at(grid::BlockGrid, idx)
block_size_at(idx, grid_size, static_sized_grid, block_size, remainder_block_size, ghosts)</code></pre><p>Theoretical size of block at <code>idx</code> in <code>grid</code>. If <code>ghosts == 0</code>, ghosts cells will be included in the size.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L492-L498">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.move_pages-Tuple{BlockGrid}" href="#Armon.move_pages-Tuple{BlockGrid}"><code>Armon.move_pages</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">move_pages(grid::BlockGrid)</code></pre><p>Move the pages of all blocks of the <code>grid</code>, including remote blocks, to the NUMA node of the thread which is in charge of working on that block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L740-L745">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.lock_pages-Tuple{BlockGrid}" href="#Armon.lock_pages-Tuple{BlockGrid}"><code>Armon.lock_pages</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">lock_pages(grid::BlockGrid)</code></pre><p>Locks the pages of all blocks of the <code>grid</code>, including remote blocks.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L762-L766">source</a></section></article><h3 id="Block-size-and-iteration"><a class="docs-heading-anchor" href="#Block-size-and-iteration">Block size and iteration</a><a id="Block-size-and-iteration-1"></a><a class="docs-heading-anchor-permalink" href="#Block-size-and-iteration" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockSize" href="#Armon.BlockSize"><code>Armon.BlockSize</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BlockSize</code></pre><p>Dimensions of a <a href="#Armon.LocalTaskBlock"><code>LocalTaskBlock</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L2-L6">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.StaticBSize" href="#Armon.StaticBSize"><code>Armon.StaticBSize</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">StaticBSize{S, Ghost} &lt;: BlockSize</code></pre><p>A <a href="#Armon.BlockSize"><code>BlockSize</code></a> of size <code>S</code> and <code>Ghost</code> cells. <code>S</code> is embedded in the type, this reduces the amount of memory in the parameters of every kernel, as well as allowing the compiler to make some minor optizations in indexing expressions.</p><p>Ghost cells are included in <code>S</code>: there are <code>S .- 2*Ghost</code> real cells.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L10-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.DynamicBSize" href="#Armon.DynamicBSize"><code>Armon.DynamicBSize</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DynamicBSize{Ghost} &lt;: BlockSize</code></pre><p>Similar to <a href="#Armon.StaticBSize"><code>StaticBSize</code></a>, but for blocks with a less-than-ideal size: block size is therefore not stored in the type. This results in less compilation when testing for different domain sizes with a constant <a href="#Armon.StaticBSize"><code>StaticBSize</code></a>.</p><p>The number of <code>Ghost</code> cells is still embedded in the type, as it can simplify some indexing expressions and for coherency.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L37-L46">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_size" href="#Armon.block_size"><code>Armon.block_size</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>NTuple</code> of the dimensions of a <a href="#Armon.BlockSize"><code>BlockSize</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.real_block_size" href="#Armon.real_block_size"><code>Armon.real_block_size</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>NTuple</code> of the dimensions of a <a href="#Armon.BlockSize"><code>BlockSize</code></a>, excluding ghost cells</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.ghosts" href="#Armon.ghosts"><code>Armon.ghosts</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Number of ghost cells of a <a href="#Armon.BlockSize"><code>BlockSize</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.border_domain" href="#Armon.border_domain"><code>Armon.border_domain</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">border_domain(bsize::BlockSize, side::Side.T; single_strip=true)</code></pre><p><a href="#Armon.DomainRange"><code>DomainRange</code></a> of the real cells along <code>side</code>.</p><p>If <code>single_strip == true</code>,  it includes only one &quot;strip&quot; of cells, that is <code>length(border_domain(bsize, side)) == size_along(bsize, side)</code>. Otherwise, there are <code>ghosts(bsize)</code> strips of cells: all real cells which would be exchanged with another block along <code>side</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L138-L147">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.ghost_domain" href="#Armon.ghost_domain"><code>Armon.ghost_domain</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ghost_domain(bsize::BlockSize, side::Side.T; single_strip=true)</code></pre><p><a href="#Armon.DomainRange"><code>DomainRange</code></a> of all ghosts cells of <code>side</code>, excluding the corners of the block.</p><p>If <code>single_strip == true</code>, then the domain is only 1 cell thick, positionned at the furthest ghost cell from the real cells. Otherwise, there are <code>ghosts(bsize)</code> strips of cells: all ghost cells which would be exchanged with another block along <code>side</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L175-L184">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_domain_range" href="#Armon.block_domain_range"><code>Armon.block_domain_range</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_domain_range(bsize::BlockSize, corners)
block_domain_range(bsize::BlockSize, bottom_left::Tuple, top_right::Tuple)</code></pre><p>A <a href="#Armon.DomainRange"><code>DomainRange</code></a> built from offsets from the corners of <code>bsize</code>.</p><p><code>block_domain_range(bsize, (0, 0), (0, 0))</code> is the domain of all real cells in the block. <code>block_domain_range(bsize, (-g, -g), (g, g))</code> would be the domain of all cells (real cells + <code>g</code> ghost cells) in the block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L61-L70">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.position" href="#Armon.position"><code>Armon.position</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">position(bsize::BlockSize, i)</code></pre><p>N-dim position of the <code>i</code>-th cell in the block.</p><p>If <code>1 ≤ position(bsize, i)[d] ≤ block_size(bsize)[d]</code> then the cell is not a ghost cell along the <code>d</code> dimension. See <a href="#Armon.is_ghost"><code>is_ghost</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L88-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.lin_position" href="#Armon.lin_position"><code>Armon.lin_position</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">lin_position(bsize::BlockSize, I)</code></pre><p>From the <code>NTuple</code> (e.g. returned from <a href="#Armon.position"><code>position</code></a>), return the linear index in the block. <code>lin_position(bsize, position(bsize, i)) == i</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L121-L126">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.in_grid" href="#Armon.in_grid"><code>Armon.in_grid</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">in_grid(idx, size)
in_grid(start, idx, size)</code></pre><p><code>true</code> if each axis of <code>idx</code> is between <code>start</code> and <code>size</code>. <code>start</code> defaults to <code>1</code>.</p><p>Argument types can any mix of <code>Integer</code>, <code>Tuple</code> or <code>CartesianIndex</code>.</p><pre><code class="language-julia hljs">julia&gt; in_grid(1, (1, 2), 2)  # same as `in_grid((1, 1), (1, 2), (2, 2))`
true

julia&gt; in_grid((3, 1), (3, 2))
true

julia&gt; in_grid((1, 3), (3, 2))
false</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L219-L237">source</a></section><section><div><pre><code class="language-julia hljs">in_grid(idx, grid, axis::Axis.T)
in_grid(start, idx, grid, axis::Axis.T)</code></pre><p>Same as <code>in_grid(start, idx, grid)</code>, but only checks along <code>axis</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L241-L246">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.is_ghost" href="#Armon.is_ghost"><code>Armon.is_ghost</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">is_ghost(bsize::BlockSize, i, o=0)</code></pre><p><code>true</code> if the <code>i</code>-th cell of the block is a ghost cell, <code>false</code> otherwise.</p><p><code>o</code> would be a &quot;ring&quot; index: <code>o == 1</code> excludes the first ring of ghost cells, etc.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L209-L215">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockRowIterator" href="#Armon.BlockRowIterator"><code>Armon.BlockRowIterator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BlockRowIterator(grid::BlockGrid; kwargs...)
BlockRowIterator(grid::BlockGrid, blk::LocalTaskBlock; kwargs...)
BlockRowIterator(grid::BlockGrid, blk₁_pos, blk₂_pos; kwargs...)
BlockRowIterator(grid::BlockGrid, sub_domain::NTuple{2, CartesianIndex}; kwargs...)
BlockRowIterator(grid::BlockGrid, row_iter::CartesianIndices; global_ghosts=false, all_ghosts=false)</code></pre><p>Iterate the rows of all blocks of the <code>grid</code>, row by row (and not block by block). This allows to iterate the cells of the <code>grid</code> as if it was a single block.</p><p>Elements are tuples of <code>(block, global_row_idx, row_range)</code>. <code>row_range</code> is the range of cells in <code>block</code> for the current row.</p><p>Giving <code>blk</code> will return an iterator on the rows of the block.</p><p>Giving <code>blk₁_pos</code> and <code>blk₂_pos</code> will return an iterator over all rows between those blocks.</p><p>Giving <code>sub_domain</code> will return an iterator including only the cells contained in <code>sub_domain</code>. <code>sub_domain</code> is a cuboid defined by the position of the cells in the whole domain of <code>grid</code>, using its lower and upper corners.</p><p><code>row_iter</code> is a iterator over global row indices.</p><p>If <code>global_ghosts == true</code>, then the ghost cells of at the border of the global domain are also returned. If <code>all_ghosts == true</code>, then the ghost cells of at the border of all blocks are also returned.</p><pre><code class="language-julia-repl hljs">julia&gt; params = ArmonParameters(; N=(24, 8), nghost=4, block_size=(20, 12), use_MPI=false);

julia&gt; grid = BlockGrid(params);

julia&gt; for (blk, row_idx, row_range) in Armon.BlockRowIterator(grid)
           println(Tuple(blk.pos), &quot; - &quot;, row_idx, &quot; - &quot;, row_range)
       end
(1, 1) - (1, 1) - 85:96
(2, 1) - (2, 1) - 85:96
(1, 1) - (1, 2) - 105:116
(2, 1) - (2, 2) - 105:116
(1, 1) - (1, 3) - 125:136
(2, 1) - (2, 3) - 125:136
(1, 1) - (1, 4) - 145:156
(2, 1) - (2, 4) - 145:156
(1, 2) - (1, 5) - 85:96
(2, 2) - (2, 5) - 85:96
(1, 2) - (1, 6) - 105:116
(2, 2) - (2, 6) - 105:116
(1, 2) - (1, 7) - 125:136
(2, 2) - (2, 7) - 125:136
(1, 2) - (1, 8) - 145:156
(2, 2) - (2, 8) - 145:156</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L329-L380">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.DomainRange" href="#Armon.DomainRange"><code>Armon.DomainRange</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DomainRange</code></pre><p>Two dimensional range to index a 2D array stored with contiguous rows. Not equivalent to <code>CartesianIndices</code> as it handles <code>StepRange</code>s properly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/domain_ranges.jl#L33-L38">source</a></section></article><h2 id="Block-states"><a class="docs-heading-anchor" href="#Block-states">Block states</a><a id="Block-states-1"></a><a class="docs-heading-anchor-permalink" href="#Block-states" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.SolverState" href="#Armon.SolverState"><code>Armon.SolverState</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SolverState</code></pre><p>Object containing all non-constant parameters needed to run the solver, as well as type-parameters needed to avoid runtime dispatch.</p><p>This object is local to a block (or set of blocks): multiple blocks could be at different steps of the solver at once.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L266-L274">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.first_state" href="#Armon.first_state"><code>Armon.first_state</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">first_state(grid::BlockGrid)</code></pre><p>A <a href="#Armon.SolverState"><code>SolverState</code></a> which can be used as a global state when outside of a solver cycle. It belongs to the first device block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L564-L569">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.SolverStep" href="#Armon.SolverStep"><code>Armon.SolverStep</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">SolverStep</code></pre><p>Enumeration of each state a <a href="#Armon.LocalTaskBlock"><code>LocalTaskBlock</code></a> can be in. <a href="#Armon.block_state_machine"><code>block_state_machine</code></a> advances this state.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L169-L174">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_state_machine" href="#Armon.block_state_machine"><code>Armon.block_state_machine</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_state_machine(params::ArmonParameters, blk::LocalTaskBlock)</code></pre><p>Advances the <a href="#Armon.SolverStep"><code>SolverStep</code></a> state of the <code>blk</code>, apply each step of the solver on the <code>blk</code>. This continues until the current cycle is done, or the block needs to wait for another block to do the ghost cells exchange (<a href="#Armon.block_ghost_exchange"><code>block_ghost_exchange</code></a>) or compute the its time step (<a href="#Armon.next_time_step"><code>next_time_step</code></a>).</p><p>Returns the new step of the block. If <code>SolverStep.NewCycle</code> is returned, the <code>blk</code> reached the end of the current cycle and will not progress any further until all other blocks have reached the same point.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver.jl#L46-L57">source</a></section></article><h3 id="Time-step-reduction"><a class="docs-heading-anchor" href="#Time-step-reduction">Time step reduction</a><a id="Time-step-reduction-1"></a><a class="docs-heading-anchor-permalink" href="#Time-step-reduction" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.next_time_step" href="#Armon.next_time_step"><code>Armon.next_time_step</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">next_time_step(params::ArmonParameters, state::SolverState, blk::LocalTaskBlock; already_contributed=false)
next_time_step(params::ArmonParameters, state::SolverState, grid::BlockGrid)</code></pre><p>Compute the time step of the next cycle. This is done at the start of the current cycle.</p><p>Since the current cycle does not rely on an up-to-date time step, the time step reduction is done fully asynchronously, including the global MPI reduction. The accuracy cost of this optimisation is minimal, as the CFL condition prevents the time step from being too large. Additionally, we prevent the time step from increasing of more than +5% of the previous one.</p><p>For first cycle, if no initial time step is given, the time step of the next cycle is reused for the initial cycle.</p><p>If <code>blk</code> is given, its contribution is only added to the <code>state.global_dt</code> (the <a href="#Armon.GlobalTimeStep"><code>GlobalTimeStep</code></a>). Passing the whole block <code>grid</code> will block until the new time step is computed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/reductions.jl#L113-L130">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.GlobalTimeStep" href="#Armon.GlobalTimeStep"><code>Armon.GlobalTimeStep</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">GlobalTimeStep</code></pre><p>Holds all information about the current time and time step for the current solver cycle. This struct is global and shared among all blocks.</p><p>When reaching <code>next_time_step</code>, blocks will contribute to the calculation of the next time step. The last block doing so will start the MPI reduction. The first block reaching the start of the next cycle will wait until this reduction is completed, updating the <code>GlobalTimeStep</code> when so.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L16-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.TimeStepState.WaitingForMPI" href="#Armon.TimeStepState.WaitingForMPI"><code>Armon.TimeStepState.WaitingForMPI</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>One thread is waiting for the MPI reduction to complete</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L9">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.TimeStepState.Done" href="#Armon.TimeStepState.Done"><code>Armon.TimeStepState.Done</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>MPI is done: <code>current_dt</code> is up-to-date</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L11">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.TimeStepState.Ready" href="#Armon.TimeStepState.Ready"><code>Armon.TimeStepState.Ready</code></a> — <span class="docstring-category">Constant</span></header><section><div><p><code>current_dt</code> is up-to-date and blocks can contribute to <code>next_dt</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L3">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.TimeStepState.DoingMPI" href="#Armon.TimeStepState.DoingMPI"><code>Armon.TimeStepState.DoingMPI</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>The MPI reduction has started</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.TimeStepState.AllContributed" href="#Armon.TimeStepState.AllContributed"><code>Armon.TimeStepState.AllContributed</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>All blocks contributed to <code>next_dt</code>, one thread will start the MPI reduction</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L5">source</a></section></article><h3 id="Block-exchanges"><a class="docs-heading-anchor" href="#Block-exchanges">Block exchanges</a><a id="Block-exchanges-1"></a><a class="docs-heading-anchor-permalink" href="#Block-exchanges" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_ghost_exchange" href="#Armon.block_ghost_exchange"><code>Armon.block_ghost_exchange</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_ghost_exchange(params::ArmonParameters, state::SolverState, blk::LocalTaskBlock)</code></pre><p>Handles communications between the <code>blk</code> neighbours, along the current <code>state.axis</code>. If <code>blk</code> is on one of the edges of the grid, a remote exchange is performed with the neighbouring <a href="#Armon.RemoteTaskBlock"><code>RemoteTaskBlock</code></a>, or the global boundary conditions are applied.</p><p>Returns <code>true</code> if exchanges were not completed, and the block is waiting on another to be ready for the exchange.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/halo_exchange.jl#L313-L322">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.start_exchange" href="#Armon.start_exchange"><code>Armon.start_exchange</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">start_exchange(
    params::ArmonParameters,
    blk::LocalTaskBlock{D, H}, other_blk::RemoteTaskBlock{B}, side::Side.T
) where {D, H, B}</code></pre><p>Start the exchange between one local block and a remote block from another sub-domain. Returns <code>true</code> if the exchange is <a href="#Armon.BlockExchangeState.Done"><code>BlockExchangeState.Done</code></a>, <code>false</code> if <a href="#Armon.BlockExchangeState.InProgress"><code>BlockExchangeState.InProgress</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/halo_exchange.jl#L219-L228">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.finish_exchange" href="#Armon.finish_exchange"><code>Armon.finish_exchange</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">finish_exchange(
    params::ArmonParameters,
    blk::LocalTaskBlock{D, H}, other_blk::RemoteTaskBlock{B}, side::Side.T
) where {D, H, B}</code></pre><p>Finish the exchange between one local block and a remote block from another sub-domain, if MPI communications are done. Returns <code>true</code> if the exchange is <a href="#Armon.BlockExchangeState.Done"><code>BlockExchangeState.Done</code></a>, <code>false</code> if <a href="#Armon.BlockExchangeState.InProgress"><code>BlockExchangeState.InProgress</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/halo_exchange.jl#L253-L263">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockInterface" href="#Armon.BlockInterface"><code>Armon.BlockInterface</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BlockInterface</code></pre><p>Represents the interface between two neighbouring <a href="#Armon.TaskBlock"><code>TaskBlock</code></a>s. It synchronizes the state of the blocks to make sure the halo exchange happens when both blocks are ready, and that the operation is done by only one of the blocks.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/blocking.jl#L260-L266">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.mark_ready_for_exchange!" href="#Armon.mark_ready_for_exchange!"><code>Armon.mark_ready_for_exchange!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mark_ready_for_exchange!(blk, side)</code></pre><p>Mark <code>blk</code> in the interface along its <code>side</code> as ready for an exchange.</p><p>Return <code>true</code> if the <code>blk</code> should do the exchange, and the new <a href="#Armon.BlockExchangeState"><code>BlockExchangeState</code></a> of the interface.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L87-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.exchange_done!" href="#Armon.exchange_done!"><code>Armon.exchange_done!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">exchange_done!(blk, side)</code></pre><p>Mark the exchange of the interface of the <code>blk</code> along <code>side</code> as done. The other block need to acknowledge this before the exchange state can be reset.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L136-L141">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.side_is_done!" href="#Armon.side_is_done!"><code>Armon.side_is_done!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">side_is_done!(blk::LocalTaskBlock, side::Side.T, done::Bool=true)</code></pre><p>Set the interface of <code>blk</code> along <code>side</code> as <code>done</code>. This is a non-atomic operation, meant only to avoid repeating the exchange logic multiple times.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L162-L167">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.is_side_done" href="#Armon.is_side_done"><code>Armon.is_side_done</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">is_side_done(blk::LocalTaskBlock, side::Side.T)</code></pre><p>The value set by <a href="#Armon.side_is_done!"><code>side_is_done!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L150-L154">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockExchangeState" href="#Armon.BlockExchangeState"><code>Armon.BlockExchangeState</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">BlockExchangeState</code></pre><p>State of an interface between two blocks, controlling if a cell exchange can happen or did happen.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L2-L6">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockExchangeState.NotReady" href="#Armon.BlockExchangeState.NotReady"><code>Armon.BlockExchangeState.NotReady</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>One of the blocks is not ready yet</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L8">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockExchangeState.InProgress" href="#Armon.BlockExchangeState.InProgress"><code>Armon.BlockExchangeState.InProgress</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>One of the blocks is performing the exchange</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockExchangeState.Done" href="#Armon.BlockExchangeState.Done"><code>Armon.BlockExchangeState.Done</code></a> — <span class="docstring-category">Constant</span></header><section><div><p>The exchange is done</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/interface.jl#L12">source</a></section></article><h3 id="Block-distribution"><a class="docs-heading-anchor" href="#Block-distribution">Block distribution</a><a id="Block-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Block-distribution" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.thread_workload_distribution" href="#Armon.thread_workload_distribution"><code>Armon.thread_workload_distribution</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">thread_workload_distribution(params::ArmonParameters; threads=nothing)
thread_workload_distribution(
    threads::Int, grid_size::Tuple;
    scotch=true, simple=false, diffuse=true, perimeter_first=false, kwargs...
)</code></pre><p>Distribute each block in <code>grid_size</code> among the <code>threads</code>, as evenly as possible.</p><p>With <code>simple == true</code>, blocks are distributed with <a href="#Armon.simple_workload_distribution"><code>simple_workload_distribution</code></a>.</p><p>With <code>scotch == true</code>, the <a href="https://gitlab.inria.fr/scotch/scotch"><code>Scotch</code></a> graph partitioning solver is used to better split the grid. <code>kwargs</code> are passed to <a href="#Armon.scotch_grid_partition"><code>scotch_grid_partition</code></a>.</p><p>If <code>perimeter_first == true</code>, the resulting distribution will have blocks sorted in way that will place neighbours of other threads&#39; blocks first in the list. By doing so, communications between threads may be overlapped more frequently.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/workload_distribution.jl#L644-L662">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.simple_workload_distribution" href="#Armon.simple_workload_distribution"><code>Armon.simple_workload_distribution</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">simple_workload_distribution(threads, grid_size)</code></pre><p>Basic distribution of <code>B = prod(grid_size)</code> blocks into groups of <code>B ÷ threads</code>, with the remaining blocks distributed evenly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/workload_distribution.jl#L415-L420">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.scotch_grid_partition" href="#Armon.scotch_grid_partition"><code>Armon.scotch_grid_partition</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">scotch_grid_partition(
    threads, grid_size;
    strategy=:default, workload_tolerance=0, repart=false, retries=10, weighted=false,
    static_sized_grid=nothing, block_size=nothing, remainder_block_size=nothing, ghosts=0
)</code></pre><p>Split <code>grid_size</code> to the <code>threads</code>.</p><p><code>strategy</code> is passed to <a href="https://keluaa.github.io/Scotch.jl/dev/#Scotch.strat_flags"><code>Scotch.strat_flags</code></a>.</p><p><code>workload_tolerance</code> is the acceptable workload uneveness among the partitions. Giving a few blocks of margin (e.g. at least <code>1/prod(grid_size)</code>) is preferrable.</p><p><code>weighted == true</code> will distribute blocks while taking into account the number of real cells they have. In this case all parameters of the grid must be present: <code>static_sized_grid</code>, <code>block_size</code>, <code>remainder_block_size</code> and <code>ghosts</code> must be given (obtained with e.g. <a href="#Armon.grid_dimensions"><code>grid_dimensions</code></a>).</p><p>The partitioning is random, hence results may vary. To counterbalance this, giving <code>retries &gt; 0</code> will repeat the partitioning <code>retries</code> times and keep the best one.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/workload_distribution.jl#L541-L561">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.block_grid_from_workload" href="#Armon.block_grid_from_workload"><code>Armon.block_grid_from_workload</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_grid_from_workload(grid_size, threads_workload)</code></pre><p>Convenience function to convert a <code>threads_workload</code> (result of <a href="#Armon.thread_workload_distribution"><code>thread_workload_distribution</code></a>) into an <code>Array</code> of <code>grid_size</code>, with each element assigned to the <code>tid</code> given by the distribution.</p><p>This makes it easy to visualize the efficiency of the distribution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/workload_distribution.jl#L448-L455">source</a></section></article><h2 id="Device-and-backends"><a class="docs-heading-anchor" href="#Device-and-backends">Device and backends</a><a id="Device-and-backends-1"></a><a class="docs-heading-anchor-permalink" href="#Device-and-backends" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.CPU_HP" href="#Armon.CPU_HP"><code>Armon.CPU_HP</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CPU_HP</code></pre><p>Device tag for the high-performance CPU backend using multithreading (with Polyester.jl) and vectorisation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/utils.jl#L80-L85">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.create_device" href="#Armon.create_device"><code>Armon.create_device</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_device(::Val{:device_name})</code></pre><p>Create a device object from its name.</p><p>Default devices:</p><ul><li><code>:CPU</code>: the CPU backend of <code>KernelAbstractions.jl</code></li><li><code>:CPU_HP</code>: <code>Polyester.jl</code> multithreading</li></ul><p>Extensions:</p><ul><li><code>:Kokkos</code>: the default <code>Kokkos.jl</code> device</li><li><code>:CUDA</code>: the <code>CUDA.jl</code> backend of <code>KernelAbstractions.jl</code></li><li><code>:ROCM</code>: the <code>AMDGPU.jl</code> backend of <code>KernelAbstractions.jl</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/parameters.jl#L741-L754">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.init_backend" href="#Armon.init_backend"><code>Armon.init_backend</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">init_backend(params::ArmonParameters, ::Dev; options...)</code></pre><p>Initialize the backend corresponding to the <code>Dev</code> device returned by <code>create_device</code> using <code>options</code>. Set the <code>params.backend_options</code> field.</p><p>It must return <code>options</code>, with the backend-specific options removed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/parameters.jl#L762-L769">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.device_memory_info" href="#Armon.device_memory_info"><code>Armon.device_memory_info</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">device_memory_info(device)</code></pre><p>The total and free memory on the device, in bytes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/parameters.jl#L920-L924">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.memory_info" href="#Armon.memory_info"><code>Armon.memory_info</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">memory_info(params)</code></pre><p>The total and free memory the current process can store on the <code>params.device</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/parameters.jl#L908-L912">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.memory_required" href="#Armon.memory_required"><code>Armon.memory_required</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">memory_required(params::ArmonParameters)</code></pre><p><code>(device_memory, host_memory)</code> required for <code>params</code>.</p><p>MPI buffers size are included in the appropriate field depending on <code>params.gpu_aware</code>. <code>params.use_MPI</code> and <code>params.neighbours</code> is taken into account.</p><p>If <code>device_is_host</code>, then, <code>device_memory</code> only includes memory required by data arrays and MPI buffers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L588-L597">source</a></section><section><div><pre><code class="language-julia hljs">memory_required(N::NTuple{2, Int}, block_size::NTuple{2, Int}, ghost::Int, data_type)
memory_required(N::NTuple{2, Int}, block_size::NTuple{2, Int}, ghost::Int,
    device_array_type, host_array_type, buffer_array_type[, solver_state_type])</code></pre><p>Compute the number of bytes needed to allocate all blocks. If only <code>data_type</code> is given, then <code>device_array_type</code>, <code>host_array_type</code> and <code>buffer_array_type</code> default to <code>Vector{T}</code>. <code>solver_state_type</code> defaults to <code>SolverState{T, #= default schemes and test =#}</code>.</p><p>In order of returned values:</p><ol><li>Amount of bytes needed for all arrays on the device. This amount is also required on the host when the host and device are not the same.</li><li>Amount of bytes needed for all MPI buffers, if the sub-domain has neighbours on all of its sides. If <code>params.gpu_aware</code>, then this memory is allocated on the device.</li><li>Amount of bytes needed on the host memory for all block objects, excluding array data and buffers. This memory is always allocated on the host.</li></ol><pre><code class="nohighlight hljs">res = memory_required((1000, 1000), (64, 64), 4, CuArray{Float64}, Vector{Float64}, Vector{Float64})
device_memory = res[1]
host_memory = res[3] + (device_is_host ? device_memory : res[1])
if params.gpu_aware
    device_memory += res[2]
else
    host_memory += res[2]
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/blocking/block_grid.jl#L632-L659">source</a></section></article><h2 id="Kernels"><a class="docs-heading-anchor" href="#Kernels">Kernels</a><a id="Kernels-1"></a><a class="docs-heading-anchor-permalink" href="#Kernels" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@generic_kernel" href="#Armon.@generic_kernel"><code>Armon.@generic_kernel</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@generic_kernel(function definition)</code></pre><p>Transforms a single kernel function into six different functions:</p><ul><li>4 which run on the CPU using Polyester.jl&#39;s multi-threading or not, as well as SIMD or not.</li><li>one which uses KernelAbstractions.jl to make a GPU-compatible kernel</li><li>a main function, which will take care of calling the two others depending if we want to use the GPU or not.</li></ul><p>To do this, two things are done:</p><ul><li>All calls to <code>@index_1D_lin()</code>, <code>@index_2D_lin()</code> and <code>@iter_idx()</code> are replaced by their equivalent in their respective platforms: a simple loop index for CPUs, and a call to KA.jl&#39;s <code>@index</code> for GPUs.</li><li>Arguments to each function are edited </li></ul><p>A kernel function must call one of <code>@index_1D_lin()</code> or <code>@index_2D_lin()</code> at least once, since this  will determine which type of indexing to use as well as which parameters to add.</p><p>The indexing macro <code>@iter_idx</code> gives the linear index to the current iteration (on CPU) or global  thread (on GPU).</p><p>This means that in order to call the new main function, one needs to take into account which indexing macro was used:</p><ul><li>In all cases, <code>params::ArmonParameters</code> is the first argument</li><li>Then, depending on the indexing macro used:<ul><li><code>@index_1D_lin()</code> : <code>loop_range::OrdinalRange{Int}</code></li><li><code>@index_2D_lin()</code> : <code>main_range::OrdinalRange{Int}</code>, <code>inner_range::OrdinalRange{Int}</code></li></ul></li><li>An optional keyword argument, <code>no_threading</code>, allows to override the <code>use_threading</code> parameter, which can be useful in asynchronous contexts. It defaults to <code>false</code>.</li></ul><p>Using KA.jl&#39;s <code>@Const</code> to annotate arguments is supported, but they will be present only in the GPU kernel definition.</p><p>Further customisation of the kernel and main function can be obtained using <code>@kernel_options</code> and <code>@kernel_init</code>.</p><pre><code class="language-julia hljs">@generic_kernel f_kernel(A)
    i = @index_1D_lin()
    A[i] += 1
end

params.use_gpu = false
f(params, 1:10)  # CPU call

params.use_gpu = true
f(params, 1:10)  # GPU call</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L940-L988">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@kernel_init" href="#Armon.@kernel_init"><code>Armon.@kernel_init</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@kernel_init(expr)</code></pre><p>Allows to initialize some internal variables of the kernel before the loop. The given expression must NOT depend on any index.  You must not use any indexing macro (<code>@index_1D_lin()</code>, etc...) in the expression.</p><p>All paramerters of the kernel are available during the execution of the init expression. On GPU, this expression will be executed by each thread.</p><p>This is a workaround for a limitation of Polyester.jl which prevents you from typing variables.</p><pre><code class="language-julia hljs">@generic_kernel function simple_kernel(a, b)
    @kernel_init begin
        c::Float64 = sin(0.123)
    end
    i = @index_1D_lin()
    a[i] += b[i] * c
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L348-L369">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@kernel_options" href="#Armon.@kernel_options"><code>Armon.@kernel_options</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@kernel_options(options...)</code></pre><p>Must be used (once, and explicitly) in the definition of a <code>@generic_kernel</code> function.</p><p>Gives options for <code>@generic_kernel</code> to adjust the resulting functions.</p><p>The possible options are:</p><ul><li><code>debug</code>:      Prints the generated functions to stdout at compile time.</li></ul><pre><code class="language-julia hljs">@generic_kernel function add_kernel(a, b)
    @kernel_options(debug)
    i = @index_1D_lin()
    a[i] += b[i]
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L326-L344">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@index_1D_lin" href="#Armon.@index_1D_lin"><code>Armon.@index_1D_lin</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@index_1D_lin()</code></pre><p>Indexing macro to use in a <code>@generic_kernel</code> function.  Returns a linear index to access the 1D arrays used by the kernel.</p><p>Cannot be used alongside <code>@index_2D_lin()</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L293-L300">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@index_2D_lin" href="#Armon.@index_2D_lin"><code>Armon.@index_2D_lin</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@index_2D_lin()</code></pre><p>Indexing macro to use in a <code>@generic_kernel</code> function.  Returns a linear index to access the 2D arrays used by the kernel.</p><p>Cannot be used alongside <code>@index_1D_lin()</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L304-L311">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@iter_idx" href="#Armon.@iter_idx"><code>Armon.@iter_idx</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@iter_idx()</code></pre><p>Indexing macro to use in a <code>@generic_kernel</code> function.  Returns a linear index to access the 2D arrays used by the kernel.</p><p>Equivalent to KernelAbstractions.jl&#39;s <code>@index(Global, Linear)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L315-L322">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@simd_loop" href="#Armon.@simd_loop"><code>Armon.@simd_loop</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@simd_loop(expr)</code></pre><p>Allows to enable/disable SIMD optimisations for a loop. When SIMD is enabled, it is assumed that there is no dependencies between each iterations of the loop.</p><pre><code class="language-julia hljs">    @simd_loop for i = 1:n
        y[i] = x[i] * (x[i-1])
    end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L196-L207">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@simd_threaded_iter" href="#Armon.@simd_threaded_iter"><code>Armon.@simd_threaded_iter</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@simd_threaded_iter(range, expr)</code></pre><p>Same as <code>@simd_threaded_loop(expr)</code>, but instead of slicing the range of the for loop in <code>expr</code>, we slice the <code>range</code> given as the first parameter and distribute the slices evenly to the threads.</p><p>The inner <code>@simd</code> loop assumes there is no dependencies between each iteration.</p><pre><code class="language-julia hljs">    @simd_threaded_iter 4:2:100 for i in 1:100
        y[i] = log10(x[i]) + x[i]
    end
    # is equivalent to (without threading and SIMD)
    for j in 4:2:100
        for i in (1:100) .+ (j - 1)
            y[i] = log10(x[i]) + x[i]
        end
    end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L265-L284">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@simd_threaded_loop" href="#Armon.@simd_threaded_loop"><code>Armon.@simd_threaded_loop</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@simd_threaded_loop(expr)</code></pre><p>Allows to enable/disable multithreading and/or SIMD of the loop depending on the parameters. When using SIMD, <code>@fastmath</code> and <code>@inbounds</code> are used.</p><p>In order to use SIMD and multithreading at the same time, the range of the loop is split in even  batches. Each batch has a size of <code>params.simd_batch</code> iterations, meaning that the inner <code>@simd</code> loop has a fixed number of iterations, while the outer threaded loop will have <code>N ÷ params.simd_batch</code> iterations.</p><p>The loop range is assumed to be increasing, i.e. this is correct: 1:2:100, this is not: 100:-2:1 The inner <code>@simd</code> loop assumes there is no dependencies between each iteration.</p><pre><code class="language-julia hljs">    @simd_threaded_loop for i = 1:n
        y[i] = log10(x[i]) + x[i]
    end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L239-L259">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@threaded" href="#Armon.@threaded"><code>Armon.@threaded</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@threaded(expr)</code></pre><p>Allows to enable/disable multithreading of the loop depending on the parameters.</p><p>The default condition is <code>params.use_threading &amp;&amp; !params.use_cache_blocking</code>. By passing <code>:outside_kernel</code> before <code>expr</code>, the condition becomes simply <code>params.use_threading</code>.</p><pre><code class="language-julia hljs">    @threaded for i = 1:n
        y[i] = log10(x[i]) + x[i]
    end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L213-L226">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@threads" href="#Armon.@threads"><code>Armon.@threads</code></a> — <span class="docstring-category">Macro</span></header><section><div><p>Controls which multi-threading library to use.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/generic_kernel.jl#L7-L9">source</a></section></article><h2 id="Logging"><a class="docs-heading-anchor" href="#Logging">Logging</a><a id="Logging-1"></a><a class="docs-heading-anchor-permalink" href="#Logging" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockLogEvent" href="#Armon.BlockLogEvent"><code>Armon.BlockLogEvent</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BlockLogEvent</code></pre><p>Info about a block, emitted after a call to <a href="#Armon.block_state_machine"><code>block_state_machine</code></a> which successfully advanced the internal state of the block, only if <code>params.log_blocks == true</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L247-L252">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.ThreadLogEvent" href="#Armon.ThreadLogEvent"><code>Armon.ThreadLogEvent</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ThreadLogEvent</code></pre><p>Info about a thread, emitted after a call to <code>solver_cycle_async</code>, which itself calls <a href="#Armon.block_state_machine"><code>block_state_machine</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L230-L234">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.collect_logs" href="#Armon.collect_logs"><code>Armon.collect_logs</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">collect_logs(grid::BlockGrid)</code></pre><p>Collect all <a href="#Armon.BlockLogEvent"><code>BlockLogEvent</code></a> of the <code>grid</code> into a single object (a <code>BlockGridLog</code>). See <a href="#Armon.analyse_log_stats"><code>analyse_log_stats</code></a> to print metrics about all blocks.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/logging.jl#L13-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.analyse_log_stats" href="#Armon.analyse_log_stats"><code>Armon.analyse_log_stats</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">analyse_log_stats(f, grid_log::BlockGridLog)</code></pre><p>Call <code>f</code> for each block of the <code>grid_log</code>, passing the block&#39;s position (a <code>CartesianIndex</code>), a <code>Vector</code> of <a href="#Armon.BlockLogEvent"><code>BlockLogEvent</code></a>s, and the size of the block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/logging.jl#L220-L225">source</a></section><section><div><pre><code class="language-julia hljs">analyse_log_stats(grid_log::BlockGridLog)</code></pre><p>Crunch all data of <code>grid_log</code> into tangible metrics contained in a <a href="#Armon.BlockGridLogStats"><code>BlockGridLogStats</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/logging.jl#L241-L245">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BlockGridLogStats" href="#Armon.BlockGridLogStats"><code>Armon.BlockGridLogStats</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BlockGridLogStats</code></pre><p>Metrics about the blocks and threads of a full solver excution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/logging.jl#L70-L74">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.BLOCK_LOG_THREAD_LOCAL_STORAGE" href="#Armon.BLOCK_LOG_THREAD_LOCAL_STORAGE"><code>Armon.BLOCK_LOG_THREAD_LOCAL_STORAGE</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">BLOCK_LOG_THREAD_LOCAL_STORAGE::Dict{UInt16, Int32}</code></pre><p>Incremented by 1 every time a <code>BlockLogEvent</code> is created in a thread, i.e. each time a block has solver kernels applied to it through <a href="#Armon.block_state_machine"><code>block_state_machine</code></a>.</p><p>Since only differences between values are interesting, no need to reset it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/solver_state.jl#L375-L382">source</a></section></article><h2 id="Utility"><a class="docs-heading-anchor" href="#Utility">Utility</a><a id="Utility-1"></a><a class="docs-heading-anchor-permalink" href="#Utility" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.Axis" href="#Armon.Axis"><code>Armon.Axis</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">Axis</code></pre><p>Enumeration of the axes of the domain</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/utils.jl#L10-L14">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.Side" href="#Armon.Side"><code>Armon.Side</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">Side</code></pre><p>Enumeration of the sides of the domain</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/utils.jl#L20-L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.SolverException" href="#Armon.SolverException"><code>Armon.SolverException</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SolverException</code></pre><p>Thrown when the solver encounters an invalid state.</p><p>The <code>category</code> field can be used to distinguish between error types without inspecting the error message:</p><ul><li><code>:config</code>: a problem in the solver configuration, usually thrown when constructing <code>ArmonParameters</code></li><li><code>:cpp</code>: a C++ exception thrown by the C++ Kokkos backend</li><li><code>:time</code>: an invalid time step</li></ul><p><code>ErrorException</code>s thrown by the solver represent internal errors.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/utils.jl#L89-L101">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.@section" href="#Armon.@section"><code>Armon.@section</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@section(name, expr)
@section(name, options, expr)</code></pre><p>Introduce a profiling section around <code>expr</code>. Sections can be nested. Sections do not introduce a new scope.</p><p>Placed before a for-loop, a new section will be started for each iteration. <code>name</code> can interpolate using loop variables (like <code>Test.@testset</code>).</p><p>It is assumed that a <code>params</code> variable of <code>ArmonParameters</code> is present in the scope of the <code>@section</code>.</p><p><code>options</code> is of the form <code>key=value</code>:</p><ul><li><code>async</code> (default: <code>false</code>): if <code>async=false</code> (and <code>!params.time_async</code>), a barrier (<code>wait(params)</code>) is added at the end of the section.</li></ul><pre><code class="language-julia hljs">params = ArmonParameters(#= ... =#)

@section &quot;Iteration $i&quot; for i in 1:10
    j = @section &quot;Foo&quot; begin
        foo(i)
    end

    @section &quot;Some calculation&quot; begin
        k = bar(i, j)
    end

    @sync begin
        @async begin
            @section &quot;Task 1&quot; async=true my_task_1(i, j, k)
        end

        @async begin
            @section &quot;Task 2&quot; async=true my_task_2(i, j, k)
        end
    end
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/profiling.jl#L108-L147">source</a></section></article><h3 id="NUMA-utilities"><a class="docs-heading-anchor" href="#NUMA-utilities">NUMA utilities</a><a id="NUMA-utilities-1"></a><a class="docs-heading-anchor-permalink" href="#NUMA-utilities" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.array_pages" href="#Armon.array_pages"><code>Armon.array_pages</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">array_pages(A::Ptr, A_length)
array_pages(A::DenseArray)</code></pre><p>Iterator over the memory pages (aligned to <code>PAGE_SIZE</code>) used by the array <code>A</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/numa_utils.jl#L2-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.touch_pages" href="#Armon.touch_pages"><code>Armon.touch_pages</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">touch_pages(pages)</code></pre><p>Parses over each of <code>pages</code> and &quot;touch&quot; them by loading a value then storing it again.</p><p>The (only) use case is to manually trigger the first-touch policy and/or force the kernel to physically allocate all pages.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/numa_utils.jl#L134-L141">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.move_pages-Union{Tuple{T}, Tuple{Array{Ptr{T}, 1}, Any}} where T" href="#Armon.move_pages-Union{Tuple{T}, Tuple{Array{Ptr{T}, 1}, Any}} where T"><code>Armon.move_pages</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">move_pages(pages::Vector{Ptr}, target_node; retries=4)
move_pages(pages::OrdinalRange{Ptr, Int}, target_node)
move_pages(A::DenseArray, target_node)</code></pre><p>Move all pages (of either the array <code>A</code> or from the <code>pages</code> iterable) to the <code>target_node</code> (1-index).</p><p>The move status of all pages is checked afterwards. No error is thrown only if all pages are on <code>target_node</code> at the end of the move.</p><p>In case some pages cannot be moved because of EBUSY status, the move is retried <code>retries</code>-times until it succeeds, with a short <code>sleep</code> in-between attempts.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/numa_utils.jl#L33-L45">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.lock_pages-Tuple{Ptr, Any}" href="#Armon.lock_pages-Tuple{Ptr, Any}"><code>Armon.lock_pages</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">lock_pages(ptr, len)
lock_pages(pages::OrdinalRange{Ptr, Int})
lock_pages(A::DenseArray)</code></pre><p>Lock the <code>pages</code> ranging from <code>ptr</code> to <code>ptr+len</code> on the RAM, preventing the kernel from moving it around or putting it in swap memory.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/numa_utils.jl#L84-L91">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Armon.unlock_pages" href="#Armon.unlock_pages"><code>Armon.unlock_pages</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">unlock_pages(ptr, len)
unlock_pages(pages::OrdinalRange{Ptr, Int})
unlock_pages(A::DenseArray)</code></pre><p>Unlock the <code>pages</code>, opposite of <a href="#Armon.lock_pages-Tuple{BlockGrid}"><code>lock_pages</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Keluaa/Armon.jl/blob/e0b0b584851607b2398d8fa70e3d93ed5cf2d1c0/src/numa_utils.jl#L102-L108">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Friday 28 June 2024 08:10">Friday 28 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
